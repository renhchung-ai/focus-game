<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>NeuroFocus 25 å°ˆæ³¨æŒ‘æˆ°</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0a0f24;
      color: #ffffff;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
      color: #00ffe0;
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(5, 80px);
      grid-gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    .cell {
      background: #1e1e2f;
      border: 2px solid #333;
      border-radius: 10px;
      font-size: 1.5em;
      padding: 20px;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s;
    }
    .correct {
      background: #00cc66 !important;
    }
    .wrong {
      background: #cc3333 !important;
    }
    #controls {
      margin-top: 20px;
    }
    #timer {
      font-size: 1.2em;
      margin-top: 10px;
    }
    select, input, button {
      font-size: 1em;
      padding: 6px 12px;
      margin: 5px;
    }
    #message {
      margin-top: 20px;
      font-size: 1.2em;
      color: #ffc107;
    }
  </style>
</head>
<body>
  <h1>NeuroFocus 25 å°ˆæ³¨åŠ›æŒ‘æˆ°</h1>

  <div id="controls">
    <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥å§“å" />
    <select id="modeSelect">
      <option value="30">30ç§’æŒ‘æˆ°</option>
      <option value="60" selected>60ç§’æŒ‘æˆ°</option>
      <option value="45">å°ˆå®¶æ¨¡å¼ï¼ˆ45ç§’ï¼‰</option>
    </select>
    <button id="startBtn">é–‹å§‹æŒ‘æˆ°</button>
    <div id="timer">â³ æ™‚é–“å‰©é¤˜ï¼š-- ç§’</div>
  </div>

  <div id="game-board"></div>
  <div id="message"></div>

  <script>
    const board = document.getElementById("game-board");
    const timerDisplay = document.getElementById("timer");
    const message = document.getElementById("message");
    const startBtn = document.getElementById("startBtn");
    const playerNameInput = document.getElementById("playerName");
    const modeSelect = document.getElementById("modeSelect");

    let numbers = [], current = 1, timeLeft = 0, countdown, gameActive = false;
    let mistakeCount = 0;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function generateBoard() {
      board.innerHTML = "";
      shuffle(numbers);
      numbers.forEach(num => {
        const div = document.createElement("div");
        div.classList.add("cell");
        div.textContent = num;
        div.onclick = () => handleClick(div, num);
        board.appendChild(div);
      });
    }

    function handleClick(cell, num) {
      if (!gameActive) return;
      if (num === current) {
        cell.classList.add("correct");
        current++;
        if (current > 25) endGame(true);
      } else {
        cell.classList.add("wrong");
        mistakeCount++;
        setTimeout(() => cell.classList.remove("wrong"), 2000);
      }
    }

    function startGame() {
      const name = playerNameInput.value.trim();
      if (!name) {
        alert("è«‹å…ˆè¼¸å…¥æ‚¨çš„å§“åï¼");
        return;
      }

      numbers = Array.from({ length: 25 }, (_, i) => i + 1);
      current = 1;
      mistakeCount = 0;
      message.textContent = "";
      gameActive = true;
      startBtn.disabled = true;
      modeSelect.disabled = true;

      timeLeft = parseInt(modeSelect.value);
      timerDisplay.textContent = `â³ æ™‚é–“å‰©é¤˜ï¼š${timeLeft} ç§’`;
      generateBoard();

      countdown = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = `â³ æ™‚é–“å‰©é¤˜ï¼š${timeLeft} ç§’`;
        if (timeLeft <= 0) endGame(false);
      }, 1000);
    }

    function endGame(success) {
      clearInterval(countdown);
      gameActive = false;
      const score = Math.max(0, 100 - mistakeCount * 4);
      const name = playerNameInput.value.trim();
      const mode = modeSelect.options[modeSelect.selectedIndex].text;

      if (success) {
        if (score === 100) {
          message.innerHTML = `ğŸ’¯ <strong>å®Œç¾è¡¨ç¾ï¼ä½ çš„å°ˆæ³¨åŠ›è¶…å¼·ï¼</strong><br>âŒ éŒ¯èª¤æ¬¡æ•¸ï¼š0<br>ğŸ† åˆ†æ•¸ï¼š<strong>100</strong> åˆ†`;
        } else {
          message.innerHTML = `ğŸ‰ æˆåŠŸå®Œæˆï¼<br>âŒ éŒ¯èª¤æ¬¡æ•¸ï¼š${mistakeCount}<br>ğŸ† åˆ†æ•¸ï¼š<strong>${score}</strong> åˆ†`;
        }
      } else {
        message.innerHTML = `â° æ™‚é–“çµæŸï¼ŒæŒ‘æˆ°å¤±æ•—<br>âŒ éŒ¯èª¤æ¬¡æ•¸ï¼š${mistakeCount}<br>ğŸ† åˆ†æ•¸ï¼š<strong>${score}</strong> åˆ†`;
      }

      // ğŸ“¤ å°‡æˆç¸¾é€å‡ºåˆ° Google Sheets
      fetch("https://script.google.com/macros/s/AKfycby3tKEcgnG4FF6Q7WYUNImDQduG4Ntc_y4MJuYG_JAVcFRgxXzR9gKZqlWZHmq_zKXE/exec", {
        method: "POST",
        body: JSON.stringify({
          name: name,
          mode: mode,
          score: score,
          mistakes: mistakeCount,
          timeLeft: timeLeft
        }),
        headers: { "Content-Type": "application/json" }
      });

      startBtn.disabled = false;
      modeSelect.disabled = false;
      startBtn.textContent = "é‡æ–°æŒ‘æˆ°";
    }

    startBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
