<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>NeuroFocus 25 專注挑戰</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0a0f24;
      color: #ffffff;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
      color: #00ffe0;
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(5, 80px);
      grid-gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    .cell {
      background: #1e1e2f;
      border: 2px solid #333;
      border-radius: 10px;
      font-size: 1.5em;
      padding: 20px;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s;
    }
    .correct {
      background: #00cc66 !important;
    }
    .wrong {
      background: #cc3333 !important;
    }
    #controls {
      margin-top: 20px;
    }
    #timer {
      font-size: 1.2em;
      margin-top: 10px;
    }
    select, input, button {
      font-size: 1em;
      padding: 6px 12px;
      margin: 5px;
    }
    #message {
      margin-top: 20px;
      font-size: 1.2em;
      color: #ffc107;
    }
  </style>
</head>
<body>
  <h1>NeuroFocus 25 專注力挑戰</h1>

  <div id="controls">
    <input type="text" id="playerName" placeholder="請輸入姓名" />
    <select id="modeSelect">
      <option value="30">30秒挑戰</option>
      <option value="60" selected>60秒挑戰</option>
      <option value="45">專家模式（45秒）</option>
    </select>
    <button id="startBtn">開始挑戰</button>
    <div id="timer">⏳ 時間剩餘：-- 秒</div>
  </div>

  <div id="game-board"></div>
  <div id="message"></div>

  <script>
    const board = document.getElementById("game-board");
    const timerDisplay = document.getElementById("timer");
    const message = document.getElementById("message");
    const startBtn = document.getElementById("startBtn");
    const playerNameInput = document.getElementById("playerName");
    const modeSelect = document.getElementById("modeSelect");

    let numbers = [], current = 1, timeLeft = 0, countdown, gameActive = false;
    let mistakeCount = 0;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function generateBoard() {
      board.innerHTML = "";
      shuffle(numbers);
      numbers.forEach(num => {
        const div = document.createElement("div");
        div.classList.add("cell");
        div.textContent = num;
        div.onclick = () => handleClick(div, num);
        board.appendChild(div);
      });
    }

    function handleClick(cell, num) {
      if (!gameActive) return;
      if (num === current) {
        cell.classList.add("correct");
        current++;
        if (current > 25) endGame(true);
      } else {
        cell.classList.add("wrong");
        mistakeCount++;
        setTimeout(() => cell.classList.remove("wrong"), 2000);
      }
    }

    function startGame() {
      const name = playerNameInput.value.trim();
      if (!name) {
        alert("請先輸入您的姓名！");
        return;
      }

      numbers = Array.from({ length: 25 }, (_, i) => i + 1);
      current = 1;
      mistakeCount = 0;
      message.textContent = "";
      gameActive = true;
      startBtn.disabled = true;
      modeSelect.disabled = true;

      timeLeft = parseInt(modeSelect.value);
      timerDisplay.textContent = `⏳ 時間剩餘：${timeLeft} 秒`;
      generateBoard();

      countdown = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = `⏳ 時間剩餘：${timeLeft} 秒`;
        if (timeLeft <= 0) endGame(false);
      }, 1000);
    }

    function endGame(success) {
      clearInterval(countdown);
      gameActive = false;
      const score = Math.max(0, 100 - mistakeCount * 4);
      const name = playerNameInput.value.trim();
      const mode = modeSelect.options[modeSelect.selectedIndex].text;

      if (success) {
        if (score === 100) {
          message.innerHTML = `💯 <strong>完美表現！你的專注力超強！</strong><br>❌ 錯誤次數：0<br>🏆 分數：<strong>100</strong> 分`;
        } else {
          message.innerHTML = `🎉 成功完成！<br>❌ 錯誤次數：${mistakeCount}<br>🏆 分數：<strong>${score}</strong> 分`;
        }
      } else {
        message.innerHTML = `⏰ 時間結束，挑戰失敗<br>❌ 錯誤次數：${mistakeCount}<br>🏆 分數：<strong>${score}</strong> 分`;
      }

      // 📤 將成績送出到 Google Sheets
      fetch("https://script.google.com/macros/s/AKfycby3tKEcgnG4FF6Q7WYUNImDQduG4Ntc_y4MJuYG_JAVcFRgxXzR9gKZqlWZHmq_zKXE/exec", {
        method: "POST",
        body: JSON.stringify({
          name: name,
          mode: mode,
          score: score,
          mistakes: mistakeCount,
          timeLeft: timeLeft
        }),
        headers: { "Content-Type": "application/json" }
      });

      startBtn.disabled = false;
      modeSelect.disabled = false;
      startBtn.textContent = "重新挑戰";
    }

    startBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
